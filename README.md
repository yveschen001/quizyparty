# QuizyParty

[![quizyparty-ci](https://github.com/yveschen001/quizyparty/actions/workflows/ci.yml/badge.svg)](https://github.com/yveschen001/quizyparty/actions/workflows/ci.yml)

æ´¾å°ç­”é¡ŒéŠæˆ²å¹³å°ï¼Œæ”¯æŒå¤šèªè¨€ã€æˆ¿é–“å”ä½œã€å–®äººéŠç©ï¼Œä¸¦æ•´åˆ RevenueCat è¨‚é–±ç®¡ç†ã€‚

## å¿«é€Ÿé–‹å§‹

### ç’°å¢ƒè¦æ±‚

- Node.js >= 18
- pnpmï¼ˆæ¨è–¦ï¼‰æˆ– npm

### å®‰è£ä¾è³´

```bash
pnpm install
```

### ç’°å¢ƒè®Šæ•¸é…ç½®

1. è¤‡è£½ `.env.example` ç‚º `.env.local`ï¼š

   ```bash
   cp .env.example .env.local
   ```

2. ç·¨è¼¯ `.env.local`ï¼Œå¡«å…¥å¿…è¦çš„ç’°å¢ƒè®Šæ•¸ï¼ˆè‡³å°‘éœ€è¦ `OPENAI_API_KEY` å’Œ `SITE`ï¼‰

### å•Ÿå‹•é–‹ç™¼ä¼ºæœå™¨

```bash
pnpm dev
```

é–‹ç™¼ä¼ºæœå™¨æœƒåœ¨ `http://localhost:4321` å•Ÿå‹•ã€‚

### æ§‹å»ºç”Ÿç”¢ç‰ˆæœ¬

```bash
pnpm build
pnpm preview  # é è¦½æ§‹å»ºçµæœ
```

## é–‹ç™¼æŒ‡å—

### é …ç›®çµæ§‹

```
QuizyParty/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ components/          # Astro çµ„ä»¶
â”‚   â”œâ”€â”€ i18n/               # å¤šèªè¨€é…ç½®èˆ‡æ–‡æ¡ˆ
â”‚   â”œâ”€â”€ lib/                # å·¥å…·å‡½æ•¸ï¼ˆbilling, locale, seo, intlï¼‰
â”‚   â”œâ”€â”€ pages/              # é é¢è·¯ç”±ï¼ˆ[lang]/, api/, robots.txt ç­‰ï¼‰
â”‚   â”œâ”€â”€ server/             # æœå‹™ç«¯é‚è¼¯ï¼ˆroom store, entitlement storeï¼‰
â”‚   â”œâ”€â”€ styles/             # å…¨å±€æ¨£å¼
â”‚   â””â”€â”€ middleware.ts       # èªè¨€æª¢æ¸¬èˆ‡é‡å®šå‘
â”œâ”€â”€ public/               # éœæ…‹è³‡æº
â”‚   â”œâ”€â”€ data/questions/    # é¡Œåº« JSON æª”æ¡ˆ
â”‚   â””â”€â”€ js/               # å®¢æˆ¶ç«¯è…³æœ¬
â”œâ”€â”€ scripts/              # å·¥å…·è…³æœ¬ï¼ˆi18n, questions, ç­‰ï¼‰
â””â”€â”€ .cursor/rules/        # Cursor é–‹ç™¼è¦ç¯„
```

### å¸¸ç”¨å‘½ä»¤

#### é–‹ç™¼èˆ‡æ§‹å»º

- `pnpm dev` - å•Ÿå‹•é–‹ç™¼ä¼ºæœå™¨
- `pnpm build` - æ§‹å»ºç”Ÿç”¢ç‰ˆæœ¬
- `pnpm preview` - é è¦½æ§‹å»ºçµæœ

#### ä»£ç¢¼å“è³ª

- `pnpm typecheck` - TypeScript é¡å‹æª¢æŸ¥
- `pnpm lint` - ESLint æª¢æŸ¥
- `pnpm format` - Prettier æ ¼å¼åŒ–
- `pnpm format:check` - æª¢æŸ¥æ ¼å¼åŒ–

#### i18n å·¥å…·

- `pnpm i18n:all` - æƒæã€ç”Ÿæˆéµå€¼ã€æª¢æŸ¥ä¸€è‡´æ€§ï¼ˆæœ¬åœ°ï¼‰
- `pnpm i18n:all:ci` - CI ç‰ˆæœ¬ï¼ˆä½¿ç”¨ pnpmï¼‰
- `pnpm i18n:scan` - æƒæä»£ç¢¼ä¸­çš„ i18n éµ
- `pnpm i18n:keygen` - ç”Ÿæˆ TypeScript éµå€¼é¡å‹
- `pnpm i18n:check` - æª¢æŸ¥æ‰€æœ‰èªè¨€çš„éµå€¼ä¸€è‡´æ€§
- `pnpm i18n:auto` - ä½¿ç”¨ OpenAI è‡ªå‹•ç¿»è­¯ç¼ºå¤±çš„éµå€¼
- `pnpm i18n:csv:export` - å°å‡º i18n éµå€¼ç‚º CSV
- `pnpm i18n:csv:import` - å¾ CSV å°å…¥ i18n éµå€¼
- ç”¢å‡ºå¯©è¨ˆå ±å‘Šï¼ˆèªè¨€ä»£ç¢¼ / i18n ä½¿ç”¨æƒ…æ³ï¼‰ï¼š

  ```bash
  mkdir -p logs
  grep -RIn --exclude-dir='.git' \
    -e 'zh[_-]Hant' -e 'zh[_-]TW' -e 'zh[_-]tw' -e 'zh[_-]HANT' \
    -e 'supportedLngs' -e 'useTranslation' -e 't(' \
    src > logs/i18n-lint.txt
  ```

  å ±å‘Šè¼¸å‡ºä½ç½®ï¼š`logs/i18n-lint.txt`

#### é¡Œåº«ç®¡ç†

- `pnpm questions:build` - å¾ CSV æ§‹å»ºé¡Œåº« JSON
- `pnpm questions:gen:pivot` - ç”Ÿæˆå¤šèªè¨€é¡Œåº«ï¼ˆä»¥è‹±æ–‡ç‚ºåŸºæº–ï¼‰
- `pnpm questions:gen:native` - ç”Ÿæˆå–®èªè¨€é¡Œåº«

#### SEO æª¢æŸ¥

- `pnpm seo:check` - æª¢æŸ¥ SEO æ¨™ç±¤å®Œæ•´æ€§

### é–‹ç™¼è¦ç¯„

æ‰€æœ‰é–‹ç™¼éœ€éµå¾ª `.cursor/rules/` ä¸­çš„è¦ç¯„ï¼š

- **æ ¸å¿ƒå®ˆé–€è¦ç¯„** (`.cursor/rules/000-core-guardrails.mdc`)ï¼šTypeScript åš´æ ¼æ¨¡å¼ã€i18nã€å®‰å…¨æ€§ã€æ•ˆèƒ½
- **i18n + SEO è¦ç¯„** (`.cursor/rules/010-i18n-seo.mdc`)ï¼šå¤šèªè¨€æ–‡æ¡ˆã€SEO æœ€ä½³å¯¦è¸
- **å®‰å…¨èˆ‡éš±ç§** (`.cursor/rules/020-security-and-privacy.mdc`)ï¼šæ•¸æ“šå®‰å…¨ã€éš±ç§ä¿è­·
- **å“è³ªæµç¨‹** (`.cursor/rules/030-quality-process.mdc`)ï¼šæ¸¬è©¦ã€CIã€PR æµç¨‹

### æœ¬åœ°é–‹ç™¼å·¥å…·

#### æ¨¡æ“¬ VIP æ¬Šç›Šï¼ˆåƒ…é–‹ç™¼ç’°å¢ƒï¼‰

```bash
# ä½¿ç”¨é–‹ç™¼ API æ¨¡æ“¬ VIP ç‹€æ…‹
curl -X POST http://localhost:4321/api/dev/entitlements/upsert \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer dev-just-for-local-testing-please-change" \
  -d '{"appUserId":"your-user-id","active":["vip"]}'
```

## åŠŸèƒ½è¦åŠƒèˆ‡é–‹ç™¼è·¯ç·šåœ–

### å·²å®Œæˆçš„ MVP åŠŸèƒ½ âœ…

1. **åŸºç¤åŠŸèƒ½**
   - âœ… å–®äººéŠç©ï¼ˆè¼‰å…¥é¡Œåº«ã€ç­”é¡Œã€çµç®—ï¼‰
   - âœ… æˆ¿é–“ç³»çµ±ï¼ˆå»ºç«‹ã€åŠ å…¥ã€ç‹€æ…‹åŒæ­¥ã€ä¸»æ©Ÿæ§åˆ¶ï¼‰
   - âœ… å¤šèªè¨€æ”¯æŒï¼ˆ7 ç¨®èªè¨€ï¼šzh-hant, zh-hans, ja, en, ko, de, frï¼‰
   - âœ… SEO åŸºç¤è¨­æ–½ï¼ˆcanonical, hreflang, OG, sitemapï¼‰
   - âœ… æ¬Šç›Š gatingï¼ˆæˆ¿é–“äººæ•¸é™åˆ¶ï¼šå…è²» 4 äººï¼ŒVIP 20 äººï¼‰

2. **é–‹ç™¼ç’°å¢ƒ**
   - âœ… TypeScript åš´æ ¼æ¨¡å¼
   - âœ… i18n å·¥å…·éˆ
   - âœ… éŒ¯èª¤è™•ç†çµ±ä¸€
   - âœ… åŸºç¤ UI/UX å„ªåŒ–

### å¾…å¯¦ä½œçš„åŠŸèƒ½è¦åŠƒ ğŸ“‹

#### ç¬¬ä¸‰éšæ®µï¼šåŠŸèƒ½å¢å¼·ï¼ˆå„ªå…ˆï¼‰

1. **ç”¨æˆ¶èªè­‰ç³»çµ±** ğŸ”
   - Google OAuth ç™»å…¥
   - ç¤¾äº¤ç¶²è·¯ç™»å…¥ï¼ˆFacebookã€Twitter ç­‰ï¼‰
   - ç”¨æˆ¶è³‡æ–™åº«ï¼ˆSQLite/PostgreSQLï¼‰
   - Session ç®¡ç†
   - ç”¨æˆ¶é ­åƒèˆ‡è³‡æ–™

2. **é¦–é åŠŸèƒ½å¢å¼·** ğŸ 
   - ç†±é–€æˆ¿é–“å±•ç¤ºï¼ˆæŒ‰åƒèˆ‡äººæ•¸æ’åºï¼‰
   - æœ€æ–°æˆ¿é–“åˆ—è¡¨ï¼ˆæŒ‰å‰µå»ºæ™‚é–“æ’åºï¼‰
   - æˆ¿é–“æœç´¢åŠŸèƒ½
   - æˆ¿é–“åˆ†é¡æ¨™ç±¤

3. **å€‹äººé é¢** ğŸ‘¤
   - ç”¨æˆ¶è³‡æ–™ç®¡ç†
   - ç­”åˆ†è¨˜éŒ„ï¼ˆæ­·å²ç­”é¡Œè¨˜éŒ„ï¼‰
   - è‡ªå®šç¾©é¡Œåº«ç®¡ç†
   - çµ±è¨ˆæ•¸æ“šï¼ˆç­”å°ç‡ã€åƒèˆ‡æˆ¿é–“æ•¸ç­‰ï¼‰
   - æˆå°±ç³»çµ±

4. **æˆ¿é–“åŠŸèƒ½å¢å¼·** ğŸ®
   - æˆ¿é–“åˆ—è¡¨ API
   - æˆ¿é–“æ­·å²è¨˜éŒ„
   - æˆ¿é–“è¨­ç½®ï¼ˆé¡Œåº«é¸æ“‡ã€æ™‚é–“é™åˆ¶ã€é›£åº¦è¨­ç½®ï¼‰
   - æˆ¿é–“åˆ†äº«åŠŸèƒ½

5. **UI/UX è¨­è¨ˆç³»çµ±** ğŸ¨
   - å®Œæ•´è¨­è¨ˆè¦ç¯„ï¼ˆé¡è‰²ã€å­—é«”ã€é–“è·ï¼‰
   - çµ„ä»¶åº«ï¼ˆæŒ‰éˆ•ã€å¡ç‰‡ã€è¡¨å–®ã€æ¨¡æ…‹æ¡†ï¼‰
   - éŸ¿æ‡‰å¼ä½ˆå±€å„ªåŒ–
   - å‹•ç•«æ•ˆæœï¼ˆéæ¸¡ã€è¼‰å…¥ã€åé¥‹ï¼‰
   - æ·±è‰²æ¨¡å¼æ”¯æŒ

6. **ç­”åˆ†è¨˜éŒ„ç³»çµ±** ğŸ“Š
   - ç­”é¡Œæ­·å²è¨˜éŒ„
   - çµ±è¨ˆæ•¸æ“šåˆ†æ
   - æ’è¡Œæ¦œåŠŸèƒ½
   - å€‹äººæœ€ä½³è¨˜éŒ„

#### ç¬¬å››éšæ®µï¼šå“è³ªèˆ‡æ•ˆèƒ½ï¼ˆå„ªåŒ–ï¼‰

7. **æˆ¿é–“æŒä¹…åŒ–**
   - å°‡ in-memory æ”¹ç‚ºè³‡æ–™åº«å­˜å„²
   - æ”¯æŒæˆ¿é–“åˆ—è¡¨æŸ¥è©¢
   - æˆ¿é–“æ­·å²è¨˜éŒ„

8. **å¯¦æ™‚åŒæ­¥å‡ç´š**
   - å¾è¼ªè©¢æ”¹ç‚º WebSocket/SSE
   - æ¸›å°‘å»¶é²å’Œæœå‹™å™¨è² è¼‰

9. **é¡Œåº«æ“´å……**
   - å¤šèªè¨€é¡Œåº«å®Œå–„
   - åˆ†é¡é¡Œåº«ï¼ˆä¸€èˆ¬ã€VIP å°ˆå±¬ç­‰ï¼‰
   - é¡Œåº«ç®¡ç†å·¥å…·

10. **æ¸¬è©¦æ¡†æ¶**
    - å–®å…ƒæ¸¬è©¦ï¼ˆVitestï¼‰
    - E2E æ¸¬è©¦ï¼ˆPlaywrightï¼‰
    - CI æ¸¬è©¦æµç¨‹

11. **æ•ˆèƒ½å„ªåŒ–**
    - ä»£ç¢¼åˆ†å‰²
    - åœ–ç‰‡å„ªåŒ–
    - API éŸ¿æ‡‰å¿«å–
    - è¼ªè©¢å„ªåŒ–

#### ç¬¬äº”éšæ®µï¼šéƒ¨ç½²æº–å‚™ï¼ˆä¸Šç·šï¼‰

12. **éƒ¨ç½²æº–å‚™**
    - ç’°å¢ƒè®Šæ•¸é…ç½®
    - æ§‹å»ºå„ªåŒ–
    - éŒ¯èª¤ç›£æ§
    - æ—¥èªŒç³»çµ±

13. **æ­£å¼éƒ¨ç½²**
    - Vercel é…ç½®
    - åŸŸåè¨­ç½®
    - SSLã€CDN
    - ç›£æ§å‘Šè­¦

### å¸¸è¦‹å•é¡Œ

#### 1. æˆ¿é–“ç‹€æ…‹ä¸åŒæ­¥ï¼Ÿ

- ç›®å‰ä½¿ç”¨è¼ªè©¢ï¼ˆæ¯ 2 ç§’ï¼‰ï¼Œå¾ŒçºŒæœƒå‡ç´šç‚º WebSocket/SSE

#### 2. i18n éµå€¼ç¼ºå¤±ï¼Ÿ

- åŸ·è¡Œ `pnpm i18n:all` æª¢æŸ¥
- ä½¿ç”¨ `pnpm i18n:auto` è‡ªå‹•ç¿»è­¯ï¼ˆéœ€è¦ OpenAI API Keyï¼‰

#### 3. é¡Œåº«è¼‰å…¥å¤±æ•—ï¼Ÿ

- ç¢ºèª `public/data/questions/{lang}.json` å­˜åœ¨
- æª¢æŸ¥ JSON æ ¼å¼æ˜¯å¦æ­£ç¢º

#### 4. æ§‹å»ºå¤±æ•—ï¼Ÿ

- åŸ·è¡Œ `pnpm typecheck` æª¢æŸ¥é¡å‹éŒ¯èª¤
- åŸ·è¡Œ `pnpm lint` æª¢æŸ¥ä»£ç¢¼è¦ç¯„
- ç¢ºèªæ‰€æœ‰ i18n éµå€¼å®Œæ•´ï¼ˆ`pnpm i18n:check`ï¼‰

#### 5. ç”¨æˆ¶ç™»å…¥åŠŸèƒ½åœ¨å“ªè£¡ï¼Ÿ

- **ç›®å‰æœªå¯¦ä½œ**ï¼Œè¦åŠƒåœ¨ç¬¬ä¸‰éšæ®µå¯¦ä½œ
- å°‡æ”¯æ´ Google OAuth å’Œç¤¾äº¤ç¶²è·¯ç™»å…¥
- éœ€è¦å…ˆå¯¦ä½œç”¨æˆ¶è³‡æ–™åº«å’Œ Session ç®¡ç†

#### 6. é¦–é ç†±é–€æˆ¿é–“å±•ç¤ºåœ¨å“ªè£¡ï¼Ÿ

- **ç›®å‰æœªå¯¦ä½œ**ï¼Œè¦åŠƒåœ¨ç¬¬ä¸‰éšæ®µå¯¦ä½œ
- éœ€è¦å…ˆå¯¦ä½œæˆ¿é–“æŒä¹…åŒ–ï¼ˆè³‡æ–™åº«å­˜å„²ï¼‰
- ç„¶å¾Œæ‰èƒ½å¯¦ç¾æˆ¿é–“åˆ—è¡¨ã€æ’åºã€æœç´¢åŠŸèƒ½

#### 7. å€‹äººé é¢å’Œç­”åˆ†è¨˜éŒ„åœ¨å“ªè£¡ï¼Ÿ

- **ç›®å‰æœªå¯¦ä½œ**ï¼Œè¦åŠƒåœ¨ç¬¬ä¸‰éšæ®µå¯¦ä½œ
- éœ€è¦å…ˆå¯¦ä½œç”¨æˆ¶èªè­‰ç³»çµ±
- ç„¶å¾Œå»ºç«‹ç­”åˆ†è¨˜éŒ„æ•¸æ“šæ¨¡å‹å’Œå­˜å„²

#### 8. ç¾è§€çš„ UI/UX åœ¨å“ªå€‹éšæ®µè½åœ°ï¼Ÿ

- **ç›®å‰åªæœ‰åŸºç¤æ¨£å¼**ï¼Œå®Œæ•´è¨­è¨ˆç³»çµ±è¦åŠƒåœ¨ç¬¬ä¸‰éšæ®µ
- å°‡åŒ…å«ï¼šè¨­è¨ˆè¦ç¯„ã€çµ„ä»¶åº«ã€éŸ¿æ‡‰å¼ä½ˆå±€ã€å‹•ç•«æ•ˆæœ
- å»ºè­°åœ¨å¯¦ä½œç”¨æˆ¶èªè­‰å’Œå€‹äººé é¢æ™‚åŒæ­¥å®Œå–„ UI/UX

---

## Secrets æŒ‡å—ï¼ˆQuizyPartyï¼‰

### è®Šæ•¸åˆ†å±¤

- **ç€è¦½å™¨å¯è¦‹ï¼ˆ`PUBLIC_` å‰ç¶´ï¼‰**ï¼šç´”å±•ç¤º/ä¸èŠ±éŒ¢/ç„¡æ¬Šé™ï¼ˆå¦‚ç«™å°åã€åŠŸèƒ½æ——æ¨™ï¼‰ã€‚
- **ä¼ºæœå™¨ç§å¯†ï¼ˆç„¡ `PUBLIC_`ï¼‰**ï¼šOpenAIã€Webhook é©—è­‰ã€Google/Apple æ†‘è­‰ç­‰ï¼Œ**åªæ”¾å¾Œç«¯/CI**ã€‚

### æ¨è–¦æ¸…å–®

- `OPENAI_API_KEY`ï¼ˆå¾Œç«¯/CIï¼ŒâŒä¸å¯æš´éœ²ï¼‰
- `RC_WEBHOOK_AUTH`ï¼ˆå¾Œç«¯/CIï¼›RevenueCat Webhook æœƒå¸¶ Authorization headerï¼Œä¼ºæœå™¨éœ€é©—è­‰ï¼‰
- `RC_ENTITLEMENT_KEY`ï¼ˆä¾‹ï¼š`vip`ï¼Œâœ¨å¯æš´éœ²ï¼‰
- `RC_IOS_PUBLIC_API_KEY` / `RC_ANDROID_PUBLIC_API_KEY`ï¼ˆRC çš„ã€Œå…¬é–‹ã€SDK keyï¼Œâœ…å¯æ‰“åŒ…ï¼‰
- `GOOGLE_SA_JSON`ï¼ˆGoogle Play æœå‹™å¸³æˆ¶ JSONï¼Œå¾Œç«¯/CIï¼ŒâŒï¼‰
- `APPLE_ISSUER_ID` / `APPLE_KEY_ID` / `APPLE_PRIVATE_KEY`ï¼ˆApp Store Server APIï¼Œç”¨æ–¼ç°½ JWTï¼Œå¾Œç«¯/CIï¼ŒâŒï¼‰
- `SITE`ï¼ˆå¦‚ `https://quizyparty.com`ï¼Œâœ…å¯æš´éœ²ï¼‰

> RevenueCat å®˜æ–¹å»ºè­°ï¼šWebhook è§¸ç™¼å¾Œ**å†èª¿ RC REST API**åŒæ­¥æœ€æ–°ç‹€æ…‹ï¼ˆå¸¸è¦‹ç‚º `GET /v1/subscribers/{app_user_id}`ï¼‰ã€‚:contentReference[oaicite:1]{index=1}

### `.env` èˆ‡éƒ¨ç½²

- ç‰ˆæœ¬æ§åˆ¶ï¼šæäº¤ `.env.example`ï¼ˆç¤ºä¾‹å€¼ï¼‰ï¼Œ**å‹¿æäº¤** `.env.local`ã€‚
- GitHub Actionsï¼šåœ¨ repo **Settings â†’ Secrets and variables â†’ Actions â†’ New repository secret** æ–°å¢ä¸Šè¿°è®Šæ•¸ï¼›Workflow ç”¨ `${{ secrets.VAR_NAME }}` æ³¨å…¥ã€‚

ï¼ˆå‚™è¨»ï¼šRevenueCat v1 GET /subscribers ä»æ˜¯å¾Œç«¯åŒæ­¥å¸¸ç”¨ä½œæ³•ï¼›v2 èƒ½åŠ›é€æ­¥æ“´å……ï¼Œä½†å®˜æ–¹å»ºè­° webhook å¾Œæ‰“ REST æ‹‰é½Šè³‡æ–™ä¾ç„¶é©ç”¨ã€‚
community.revenuecat.com
+1
ï¼‰
