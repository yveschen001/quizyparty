# 題目設定與答題流程（2025 年 11 月版）

本文整理最新的題目建置、房間管理與答題流程，提供產品與工程在溝通體驗時的統一依據。

## 1. 題目建置：草稿 → 確認 → 發布

1. 使用者在「題目集」頁面進入建置精靈（Wizard）：
   - 支援逐題手動輸入或從歷史題庫勾選。
   - 任何輸入（題目、選項、標籤、標題、目標題數）都會自動儲存為草稿。
2. 系統要求選擇目標題數（10 / 20 / 30 / 40 / 50 / 60），並在摘要區即時顯示已完成題數。
3. 草稿「儲存」僅更新現有題組；若題目或題組是首次建立，後端會自動產生對應的 `question set` 與 `room template`。
4. 發布前必須完成目標題數，`PUT /api/question-sets/:id` 會阻擋不符合題數的發布請求。

> ✅ 任何草稿更新都會在 1.5 秒內自動送出 `draft` 狀態請求，不需人工點擊儲存。

## 2. 房間 = 題目集

- `create-room` 頁面提供單一路徑：先選擇題目數（10/20/30/40/50/60），即時展開對應張數的題目卡片。
- 每張卡可直接編輯題目、四個選項與正解，也可以按下「從題庫匯入」帶入歷史題目再調整。
- 每次儲存題目後，系統自動更新草稿題目集與對應的房間模板；使用者無須理解題目集的概念。
- 房名預設為「使用者名稱 + Quiz + 日期」，可隨時修改；房主頭像即為房間封面，避免手動上傳。
- 「已發布 / 草稿」分頁直接反映模板狀態，發佈或回收都會同步題目集與房間模板。

> ✅ 使用者無須理解「房間模板」是額外概念，實際上就是「我要用這個題目集開房」。

## 3. 答題與防作弊

- 房間建立時預先載入題目，並為每位房間成員生成獨立的選項順序：
  - `Room.choiceOrders` 以「成員 → 題目 → 選項陣列」儲存。
  - `getRoomState` 只要偵測成員尚未建立順序，才會隨機產生一次並持久化。
- 驗證仍採文字比對 `choice === correctAnswer`，確保順序變動不影響判題。
- 房主可取得即時統計（參與人數、排行榜、平均正確率、題目答題分佈），以利分析與迭代題目。

> ✅ 每位玩家的選項順序固定但互不相同，同時兼顧防作弊與體驗一致性。

## 4. 前後端資料同步

- 問題、題目集、房間模板三者狀態維持一致：
  - 題目發布 → 自動綁定題目集並標記為 `published`。
  - 題目集更新 → 重新同步模板狀態、標題與進度計數。
  - 房間模板發布前會檢查題目集是否已發布，避免半成品對外曝光。
- 所有新增欄位（狀態、版本、進度、標籤等）均透過 SQLite `safeAddColumn` 自動補欄，確保既有資料庫升級順暢。

## 5. 與舊版差異

- ✅ 移除「先建題目 → 再手動建題目集」的雙重心智負擔，改為單一建置流程。
- ✅ 房間不再需要額外的封面設定或手動同步題目集，避免資料分岔。
- ✅ 每位玩家的選項順序已固定，解決早期 `getRoomState` 每次重洗導致的體驗不一致問題。
- ✅ 草稿與發布流程一致化，所有輸入都會在背景自動保存。

此文件會隨產品流程調整而更新，若有新增需求或疑問，請在變更前同步維護本說明。 

